# 5. 책임 할당하기

책임에 초점을 맞춰서 설계할 때 가장 큰 어려움

- 어떤 책임을 할당할지를 결정하기 쉽지 않다.

*책임 할당 과정은 일종의 트레이드오프 활동이다.*

## 책임 주도 설계를 향해

- 데이터보다 행동을 먼저 결정하라
- 협력이라는 문맥 안에서 책임을 결정하라

### 데이터보다 행동을 먼저 결정하라

책임을 먼저 결정한 후에 객체의 상태를 결정한다.

1. 이 객체가 수행해야 하는 책임은 무엇인가
2. 이 책임을 수행하는 데 필요한 데이터는 무엇인가

## 협력이라는 문맥 안에서 책임을 결정하라

- 책임은 객체의 입장이 아니라 객체가 참여하는 협력에 적합해야 한다.
- 메시지를 전송하는 클라이언트의 의도에 적합한 책임을 할당해야 한다.
- 객체가 메시지를 선택하는 것이 아니라 `메시지가 객체를 선택`하게 해야한다.

> 책임 중심의 설계에서는 협력이라는 문맥 안에서 객체가 수행할 책임에 초점을 맞춘다.
두 원칙이 `책임 주도 설계` 방법의 핵심과 거의 동일하다

---

## 책임 할당을 위한 GRASP 패턴

"General Resposibility Assignment Software Pattern(일반적인 책임 할당을 위한 소프트웨어 패턴)" - *크레이그 라만(Craig Larman)*

- 객체에게 책임을 할당할 때 지침으로 삼을 수 있는 원칙들의 집합을 패턴 형식으로 정리한 것

### 도메인 개념에서 출발하기

- 설계 시작 전 도메인에 대한 개략적인 모습을 그려 보는 것이 유용하다.
- 도메인 안에는 많은 개념들이 존재하며 이 도메인 개념들을 책임 할당의 대상으로 사용하면 코드에 도메인의 모습을 투영하기 좀 더 수월해진다.
- 어떤 책임을 할당해야 할 때 가장 먼저 고민해야 하는 유력한 후보는 `도메인 개념`이다.

### 정보 전문가에게 책임을 할당하라

책임 주도 설계 방식의 첫 단계

- 애플리케이션이 제공해야 하는 기능을 애플리케이션의 책임으로 생각하는 것
- 이 책임을 애플리케이션에 대해 저농된 메시지로 간주하고 이 메시지를 책임질 첫 번째 객체를 선택하는 것

INFORMATION EXPERT(정보 전문가) - 책임을 수행할 정보를 알고 있는 객체에게 책임을 할당하는 것

- 객체가 자신이 소유하고 있는 정보와 관련된 작업을 수행한다는 일반적인 직관을 표현한 것이다.
- 책임을 수행하는 객체가 정보를 '알고'있다고 해서 그 정보를 '저장'하고 있을 필요는 없다.
- 어떤 방식이건 정보 전문가가 데이터를 반드시 저장하고 있을 필요는 없다.

LOW COUPULING Pattern

- 의존성을 낮추고 변화의 영향을 줄이며 재사용성을 증가시킬 수 있을까?
- 설계의 전체적인 결합도가 낮게 유지되도록 책임을 할당하라.

HIGH COHESION Pattern

- 어떻게 복잡성을 관리할 수 있는 수준으로 유지할 수 있을까?
- 높은 응집도를 유지할 수 있게 책임을 할당하라.

CREATOR Pattern

- 객체를 생성할 책임을 어떤 객체에게 할당할지에 대한 지침을 제공한다.
- 생성되는 객체와 연결되거나 관련될 필요가 있는 객체에 해당 객체를 생성할 책임을 맡기는 것이다.
- 이미 존재하는 객체 사이의 관계를 이용하기 때문에 설계가 낮은 결합도를 유지할 수 있게 한다.

POLYMORPHISM Pattern

- 객체의 타입에 따라 변하는 행동이 있다면 타입을 분리하고 변화하는 행동을 각 타입의 책임으로 할당하라.
- if ~ else, switch ~ case 등의 조건 논리를 사용해서 설계한다면, 새로운 변화가 일어난 경우 조건 논리를 수정해야한다.
    - 이는 프로그램을 수정하기 어렵고 변경에 취약하게 만든다. - 다형성을 이용해 새로운 변화를 다루기 쉽게 확장하라.

```java
public interface DiscountCondition {
    boolean isSatisfiedBy(Screening screening);
}
```

```java
public class PeriodCondition implements DiscountCondition { ... }

public class SequenceCondition implements DiscountCondition { ... }
```

Movie 는 협력하는 객체의 구체적인 타입을 몰라도, 협력하는 객체가 DiscountCondition 역할을 수행할 수 있고 isSatisfiedBy 메시지를 이해할 수 있다.

Movie 와 DiscountCondition 사이의 협력은 `다형적`이다.

PROTECTED VARIATIONS Pattern

- 책임 할당의 관점에서 캡슐화를 설명한 것이다.

---

## 변경과 유연성

개발자로서 변경에 대비할 수 있는 방법

- 코드를 이해하고 수정하기 쉽도록 최대한 단순하게 설계하는 것
- 코드를 수정하지 않고도 변경을 수용할 수 있도록 코드를 더 유연하게 만드는 것

유사한 변경이 반복적으로 발생하고 있다면 복잡성이 상승하더라도 유연성을 추가하는 두 번째 방법이 더 좋다.

상속대신 합성을 사용하라.

Movie 안에 구현된 할일 정책을 독립적인 DiscountPolicy로 분리한 후 Movie 에 합성시키면 유연한 설계를 할 수 있다.

### 책임 주도 설계의 대안

- 책임 주도 설계에 익숙해지기 위해서는 부단한 노력과 시간이 필요하다.
- 아무것도 없는 상태에서 책임과 협력에 관해 고민하기 보다는 일단 실행되는 코드를 얻고 난 후에 코드 상에 명확하게 드러나는 책임들을 올바른 위치로 이동시키자.
- 주의할 점은 코드를 수정한 후에 겉으로 드러나는 동작이 바뀌어서는 안된다. - 리팩터링(Refactoring)
- 캡슐화를 향상시키고, 응집도를 높이고, 결합도를 낮춰야 하지만 동작은 그대로 유지해야 한다.
